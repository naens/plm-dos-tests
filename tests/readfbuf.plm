readfile:
do;

$include('sys.ext')
$include('cons.ext')
$include('fio.ext')
$include('const.lit')

    declare argc word;
    declare pargv address;
    declare argv based pargv address;
    declare pname address;
    declare name based pname byte;
    declare str(16) byte;

    declare f word;
    declare n word;
    declare i word;

    call getargs(.argc, .pargv);
    call prstr(.('Opening the file ', 0));
    name = pargv + 2;
    call prstr(name);
    call prcrlf;

    f = fopen(name, true, false);
    if f <> 0ffffh then
    do;
        call println(.('File open OK!', 0));
        n = freadbuf(f, .str, 16);
        call prhexword(n);
        call prcrlf;
        do i = 0 to n - 1;
            if str(i) <= ' ' or str(i) > '~' then
                call prchr('_');
            else
                call prchr(str(i));
        end;
        call prcrlf;
        str(15) = 0;
        call println(.str);
/*        call prstr(.('EOF', 0dh, 0ah, 0));*/
        call fclose(f);
        call println(.('File close OK!', 0));
    end;
    else
    do;
        call println(.('File open ERROR.', 0));
    end;

    call term;

end readfile;
